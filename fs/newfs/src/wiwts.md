# What I Want To Say

现在是2024/12/8 上午九点多了。还记得昨天晚上，也就是4个多小时前的同一日凌晨3点多，我还在宿舍一边骂着脏话一边瞪眼法看代码哪错了。昨晚七点多开始查bug查到凌晨3点多，先是在教学楼查到了十二点物业都来关灯了，回寝室里在床下继续做了两三个小时。

在漫长的人生中，这么几个小时短暂的微不足道，却磨平了我一生的锋芒和心性，摧毁了我的素质和教养。这debug八个多小时几乎一行代码没改的时间里面我不断突破着一个文明人素质的下线。

我最早深夜以前以为bug是能否remount成功和创建东西的顺序有关。后来在深夜的时候感觉似乎是能否remount纯粹随机的。后来第二天起床发现问题是似乎创建4次，才能在remount之后看到2个。如果不记下过去十几个小时的心路历程，我怕过段时间忘了。深夜的时候，打开qq想找老师帮忙想想会是什么bug，一看时间3点多，感觉人还是要依靠自己的力量。3点半左右舍友关灯要睡，而此时我回来两三个小时鞋子都没换。再想到想不通问题出在了哪里，只觉得焦急溢出了肾脏。

这一晚到底干了什么呢？我先是一连上主机，发现copilot连不上。我离了copilot写不了代码，就好像我开车没有后视镜就不懂得倒车。跟老师报告了问题，老师没一会就修好了。之后仔细看了看一些逻辑，感觉可能有不对，给索引节点加了个已使用数据块数的字段。之后发现有时候能remount，又把代码仔细看了一遍，觉得没啥问题。最后实在无奈，干脆把整个utils文件每一个函数都过了一遍，还把绝对不会有问题的挨个注释上，这代码跑下去还是不对。输出磁盘一看，不知不觉十六进制dump文件填的到处都是。接着又到处打断点，在运行过程中看内存里面的值，似乎没太大问题。看的人恼火。最后人都麻了，舍友关灯睡觉，我连鞋都没换，赌气想背着电脑回教学楼，又一想还是睡觉好，第二天还有时间。最后因为实在太晚直接爬上床，以至于我全身的穿搭都没换，躺了半个身子到床里面就睡着了。

我这人还是比较好斗，放不下，我似乎做梦都在研究那个dump的位图对不对。不知不觉中发现7就是111，刚好对应根目录一个，创建的东西两个。但是111的这个位图好像不能够remount。一闭眼3个小时过去了，早上6点五十多，我不但醒了，而且接下来该如何debug的方案在我脑海里挥之不去，索性就下床继续看。

多运行了两次我终于发现一件事情，伴随着好消息和坏消息。那就是前一天晚上，准确来讲是八个小时以前，我之所以remount成功，可能是个碰巧。坏消息就是昨晚的分析都是浪费时间。但好消息是我发现bug的本质是创建文件的次数有关系，创建4次似乎能看到2个文件并且能够重新挂载。我一想到一天后的9号就要验收，觉得可以慢慢看磁盘dump，做一个操作输出一次，把预期的画在纸上，看哪次的dump和预期不同，这一次涉及的操作就出了问题。

于是我八点钟背上电脑上教学楼去找个大桌子，这是我一年以来出门最早的一次。为了挽救我熬大夜的状态，我甚至开淘宝点了一杯9块7毛钱的瑞幸。对于我这种一天花不到20元生活费的穷鬼，这杯瑞幸超过了我一天过半的生活费。结果我在1个小时后的9点多就把问题解决了并测出了30分。

我是怎么找到bug的呢？我发现在根目录创建一个文件后，对应磁盘里面存储的目录项里的ino是负数，大概是和inode的分配有关系。于是我开调试器仔细过了一遍，结果很容易地找到了逻辑不对的地方。当我看见这个位置的错误，我的心情是单纯觉得过去把半天的人生喂了狗，整出这种bug，唐完了。可以说调试的这段时间里，平均一小时改的字符不到1个，平均改1个字符用了超过一个小时。没有空闲节点的判断那块，可能是复制东西的时候，或者是补齐代码的时候选错了，导致ino为1就以为没空间返回。这种调试真是让人越改越生气。

为什么会写出那样的判断，原因是模仿sfs写的。因为这个代码完全就是复制过来改一下对应变量，谁会想得到这里会把对应变量改错了呢。不过我觉得不必唏嘘一个细小的错误造成大量的时间投入在上面纠错，也许原本就该花这么多时间。你总会因为某个原因赔上工作量，遇到任何一种bug都是你和它的缘分。

